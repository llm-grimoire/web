---
import { getCollection } from "astro:content";
import Layout from "../components/Layout.astro";
import GrimoireCard from "../components/GrimoireCard.astro";

const grimoires = await getCollection("grimoires");
---
<Layout title="Catalog">
  <div class="hero">
    <img src="/logo.svg" alt="Grimoire" width="115" height="160" style="margin-bottom: 1.5rem;" />
    <h2>Grimoire</h2>
    <p>A CLI that gives your AI agent codebase guides</p>
  </div>

  <section class="getting-started">
    <h3>Get Started</h3>
    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-content">
          <div class="step-title">Install the CLI</div>
          <code class="step-code">npm install -g @llm-grimoire/cli</code>
        </div>
      </div>
      <div class="step">
        <div class="step-num">2</div>
        <div class="step-content">
          <div class="step-title">Add a grimoire from the registry</div>
          <code class="step-code">grimoire add effect-atom</code>
        </div>
      </div>
      <div class="step">
        <div class="step-num">3</div>
        <div class="step-content">
          <div class="step-title">Or conjure one from any codebase</div>
          <code class="step-code">grimoire conjure --github owner/repo</code>
        </div>
      </div>
      <div class="step">
        <div class="step-num">4</div>
        <div class="step-content">
          <div class="step-title">Feed it to your agent</div>
          <code class="step-code">grimoire incant my-project | pbcopy</code>
        </div>
      </div>
    </div>
  </section>

  <section class="registry-section">
    <h3>Registry</h3>
    <div class="grid">
      {grimoires.map((g) => (
        <GrimoireCard
          grimoireName={g.data.grimoireName}
          github={g.data.github}
          description={g.data.description}
          topicCount={g.data.topicCount}
        />
      ))}
    </div>
    {grimoires.length === 0 && (
      <p style="text-align: center; color: var(--text-muted);">
        No grimoires in the registry yet.
      </p>
    )}
  </section>
</Layout>

<style>
  .getting-started {
    margin-bottom: 3rem;
  }
  .getting-started h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text);
  }
  .steps {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .step {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.25rem;
  }
  .step-num {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--accent);
    color: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.85rem;
    flex-shrink: 0;
  }
  .step-content {
    flex: 1;
  }
  .step-title {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 0.25rem;
  }
  .step-code {
    font-size: 0.9rem;
    color: var(--text);
    background: none;
    border: none;
    padding: 0;
  }
  .registry-section {
    margin-bottom: 3rem;
  }
  .registry-section h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text);
  }
</style>
