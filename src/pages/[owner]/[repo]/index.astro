---
import { getCollection } from "astro:content";
import Layout from "../../../components/Layout.astro";
import TopicList from "../../../components/TopicList.astro";
import CliHint from "../../../components/CliHint.astro";

export async function getStaticPaths() {
  const grimoires = await getCollection("grimoires");
  const topics = await getCollection("topics");

  return grimoires.map((g) => ({
    params: { owner: g.data.owner, repo: g.data.repo },
    props: {
      grimoire: g.data,
      topics: topics
        .filter((t) => t.data.owner === g.data.owner && t.data.repo === g.data.repo)
        .map((t) => t.data),
    },
  }));
}

const { grimoire, topics } = Astro.props;
---
<Layout title={grimoire.name}>
  <div class="breadcrumb">
    <a href="/">Catalog</a> / {grimoire.owner}/{grimoire.repo}
  </div>
  <CliHint command={`list ${grimoire.owner}/${grimoire.repo}`} />
  <div class="detail-header">
    <h2>{grimoire.name}</h2>
    <div class="owner-repo">{grimoire.owner}/{grimoire.repo}</div>
    <p>{grimoire.description}</p>
    <div class="detail-meta">
      <span>{grimoire.topicCount} topics</span>
      {grimoire.github && (
        <a href={`https://github.com/${grimoire.github}`}>GitHub</a>
      )}
    </div>
  </div>
  <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">Topics</h3>
  <TopicList owner={grimoire.owner} repo={grimoire.repo} topics={topics} />
  <CliHint command={`add ${grimoire.owner}/${grimoire.repo}`} />
</Layout>
